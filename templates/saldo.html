{% extends 'base.html' %}
{% block content %}
<h2 class="text-center text-primary mb-4">Consulta de Saldo</h2>
<p class="text-center text-muted mb-4">Clique em um tipo de roupa para visualizar os lotes em estoque.</p>

<div class="row">
    <!-- Tipos -->
    <div class="col-md-4">
        <div class="list-group shadow-sm">
            {% for tipo in roupas_por_tipo.keys() %}
            <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                    onclick="mostrarSaldo('{{ tipo }}')">
                <span><i class="bi bi-tag me-2 text-secondary"></i>{{ tipo | title }}</span>
                <i class="bi bi-chevron-right"></i>
            </button>
            {% endfor %}
        </div>
    </div>

    <!-- Saldo -->
    <div class="col-md-8">
        <h5 id="titulo-lote" class="text-secondary mb-3">Selecione um tipo para visualizar o saldo</h5>
        <div id="saldo-container" class="bg-light p-3 rounded shadow-sm border mb-4"></div>

        <a href="/" class="btn btn-outline-secondary w-100 mt-3">
            <i class="bi bi-arrow-left-circle me-1"></i> Voltar ao In√≠cio
        </a>
    </div>
</div>

<script type="text/javascript">
    const roupas = JSON.parse('{{ roupas_por_tipo | tojson | safe }}');

    function mostrarSaldo(tipo) {
        const container = document.getElementById("saldo-container");
        const titulo = document.getElementById("titulo-lote");
        titulo.innerText = "Saldo de: " + tipo;

        let html = `
            <div class="table-responsive">
                <table class="table table-hover table-bordered align-middle">
                    <thead class="table-primary text-center">
                        <tr>
                            <th>Tamanho</th>
                            <th>Lote</th>
                            <th>Validade</th>
                            <th>Quantidade</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        roupas[tipo].forEach(function(r) {
            const tamanho = r[3];
            const lote = r[4] || '-';
            const validade = r[5] || '-';
            const qtd = r[6];

            html += `
                <tr class="text-center">
                    <td>${tamanho}</td>
                    <td>${lote}</td>
                    <td>${validade}</td>
                    <td><span class="badge bg-success fs-6">${qtd}</span></td>
                </tr>
            `;
        });

        html += '</tbody></table></div>';
        container.innerHTML = html;
    }
</script>
{% endblock %}
